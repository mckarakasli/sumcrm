{% extends 'base.html' %} {% block title %}Müşteriler{% endblock %} {% block content %}
<div class="container-fluid py-4">

    <!-- Başlık ve Arama -->
    <div class="row mb-4 align-items-center">
        <div class="col-md-6 col-12 mb-2 mb-md-0">
            <h3 class="mb-0">
                <i class="bi bi-people-fill text-primary"></i> Müşteriler
            </h3>
        </div>
        <div class="col-md-6 col-12">
            <input type="text" id="searchInput" class="form-control" placeholder="Müşteri adına göre ara...">
        </div>
    </div>

    <!-- Masaüstü Tablosu -->
    <div class="card shadow-sm border-0 d-none d-md-block">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table align-middle mb-0" id="customerTable">
                    <thead class="table-primary">
                        <tr>
                            <th>Mükellef Kodu</th>
                            <th>Ünvan</th>
                            <th>Yetkili Ad-Soyad</th>
                            <th>E-posta</th>
                            <th>Telefon</th>
                            <th>Durum</th>
                        </tr>
                    </thead>
                    <tbody id="customerTbody">
                        {% for customer in customers %}
                        <tr class="table-row" onclick="window.location.href='/customer/{{ customer.id }}/jobs'">
                            <td>{{ customer.code }}</td>
                            <td>{{ customer.company }}</td>
                            <td>{{ customer.full_name }}</td>
                            <td>{{ customer.email }}</td>
                            <td>{{ customer.phone }}</td>
                            <td>
                                {% if customer.status == 1 %}
                                <span class="badge bg-success">Aktif</span> {% else %}
                                <span class="badge bg-warning text-dark">Pasif</span> {% endif %}
                            </td>
                        </tr>
                        {% endfor %} {% if customers|length == 0 %}
                        <tr>
                            <td colspan="6" class="text-center text-muted py-3">Henüz müşteri bulunamadı!</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Mobil Kartlar -->
    <div class="d-block d-md-none" id="customerCards">
        {% for customer in customers %}
        <div class="card shadow-sm mb-3 card-hover" onclick="window.location.href='/customer/{{ customer.id }}/jobs'">
            <div class="card-body">
                <h5 class="card-title">{{ customer.company }}</h5>
                <p class="mb-1"><strong>Kod:</strong> {{ customer.code }}</p>
                <p class="mb-1"><strong>Yetkili:</strong> {{ customer.full_name }}</p>
                <p class="mb-1"><strong>E-posta:</strong> {{ customer.email }}</p>
                <p class="mb-1"><strong>Telefon:</strong> {{ customer.phone }}</p>
                <p class="mb-1"><strong>Durum:</strong> {% if customer.status == 1 %}
                    <span class="badge bg-success">Aktif</span> {% else %}
                    <span class="badge bg-warning text-dark">Pasif</span> {% endif %}
                </p>
            </div>
        </div>
        {% endfor %} {% if customers|length == 0 %}
        <div class="alert alert-warning text-center">Henüz müşteri bulunamadı!</div>
        {% endif %}
    </div>

    <!-- Pagination -->
    <nav aria-label="Customer pagination" class="mt-3">
        <ul class="pagination justify-content-center" id="pagination"></ul>
    </nav>

    <!-- Floating Add Button -->
    <a href="/customers/add" class="btn btn-primary rounded-circle shadow-lg d-flex justify-content-center align-items-center position-fixed" style="bottom: 40px; right: 40px; width: 60px; height: 60px; font-size: 24px; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'"
        onmouseout="this.style.transform='scale(1)'">
        <i class="bi bi-plus"></i>
    </a>

</div>

<script>
    const searchInput = document.getElementById('searchInput');
    const tableRows = document.querySelectorAll('#customerTbody tr');
    const cards = document.querySelectorAll('#customerCards .card');

    const rowsPerPage = 10;
    let currentPage = 1;

    function paginate(items, page = 1, perPage = 10) {
        const start = (page - 1) * perPage;
        const end = start + perPage;
        return items.slice(start, end);
    }

    function renderPagination(totalItems, perPage = 10) {
        const totalPages = Math.ceil(totalItems / perPage);
        const paginationEl = document.getElementById('pagination');
        paginationEl.innerHTML = '';

        for (let i = 1; i <= totalPages; i++) {
            const li = document.createElement('li');
            li.className = 'page-item ' + (i === currentPage ? 'active' : '');
            li.innerHTML = `<a class="page-link" href="#">${i}</a>`;
            li.addEventListener('click', (e) => {
                e.preventDefault();
                currentPage = i;
                updateView();
            });
            paginationEl.appendChild(li);
        }
    }

    function updateView() {
        const value = searchInput.value.toLowerCase();

        // Table
        const filteredRows = Array.from(tableRows).filter(row => {
            if (!row.cells[1]) return false;
            return row.cells[1].textContent.toLowerCase().includes(value);
        });
        tableRows.forEach(r => r.style.display = 'none');
        paginate(filteredRows, currentPage, rowsPerPage).forEach(r => r.style.display = '');

        // Cards
        const filteredCards = Array.from(cards).filter(card => card.querySelector('.card-title').textContent
            .toLowerCase().includes(value));
        cards.forEach(c => c.style.display = 'none');
        paginate(filteredCards, currentPage, rowsPerPage).forEach(c => c.style.display = '');

        renderPagination(filteredRows.length);
    }

    searchInput.addEventListener('input', () => {
        currentPage = 1;
        updateView();
    });

    updateView();
</script>


{% endblock %}